# MeetMind v2.0 版本规划

## 版本主题：学习过程可见性

**核心理念**：不新增功能，只让已有数据流动起来。

---

## 一、现状盘点

### 已有的数据资产

| 数据 | 存储位置 | 当前用途 | 未被利用的价值 |
|------|----------|----------|----------------|
| `createdAt` | Anchor 表 | 记录困惑点创建时间 | 可计算"从困惑到解决"的时长 |
| `resolvedAt` | Anchor 表 | 记录点击"我懂了"的时间 | 可计算学习时长、判断是否解决 |
| `status` | Anchor 表 | 区分 active/resolved | 可计算搞定率 |
| `chatHistory` | TutorResponseCache 表 | 缓存对话记录 | 可计算对话轮数、追问次数 |
| `aiExplanation` | Anchor 表 | 存储 AI 解释 | 可判断是否看过 AI 解释 |

### 已有的交互闭环

学生端已经实现了完整的闭环：

```
标记困惑 → AI辅导 → 我懂了
   ↓          ↓         ↓
WaveformPlayer  AITutor   resolveAnchor()
```

**问题在于**：这个闭环产生的数据，没有流向家长端和老师端。

---

## 二、本版本目标

**一句话**：把学生端已经产生的学习数据，呈现给家长和老师。

**不做的事**：
- 不改学生端交互
- 不加新的数据采集
- 不做复杂的数据分析
- 不做跨课程的趋势统计

---

## 三、具体改动

### 3.1 家长端改动

**改动文件**：`src/app/parent/page.tsx`、`src/lib/services/parent-service.ts`

**改动内容**：

1. **今日概览卡片**：把"待解决/已解决"改为更直观的表达

   现状：
   ```
   待解决: 2  |  已解决: 3
   ```
   
   改为：
   ```
   困惑点: 5个 → 已搞定 3个 ✅
   ```

2. **困惑点列表**：增加"学习时长"和"对话轮数"两个指标

   现状：
   ```
   🔴 勾股定理推导  02:05
      老师原话："..."
   ```
   
   改为：
   ```
   ✅ 勾股定理推导  02:05
      学习 23分钟 · 对话 3轮
      老师原话："..."
   ```

3. **数据来源**：
   - 学习时长 = `resolvedAt - createdAt`（如果已解决）
   - 对话轮数 = 解析 `TutorResponseCache.chatHistory` 的数组长度
   - 状态图标 = 根据 `status` 字段判断

### 3.2 老师端改动

**改动文件**：`src/components/teacher/TeacherDashboard.tsx`

**改动内容**：

1. **困惑热点表格**：增加"搞定率"列

   现状：
   ```
   时间段      困惑人数    转录内容
   02:00-02:30   12人      "..."
   ```
   
   改为：
   ```
   时间段      困惑人数    搞定率    转录内容
   02:00-02:30   12人      25%      "..."
   ```

2. **搞定率计算**：
   - 分子 = 该时间窗口内 `status === 'resolved'` 的困惑点数
   - 分母 = 该时间窗口内的总困惑点数

3. **视觉提示**：搞定率低于 50% 的行，显示"建议重讲"标签

### 3.3 数据层改动

**改动文件**：`src/lib/services/parent-service.ts`、`src/lib/services/classroom-data-service.ts`

**改动内容**：

1. **ParentDailyReport 接口扩展**：

   ```typescript
   interface ConfusionPoint {
     // 现有字段...
     
     // 新增
     learningDurationMs?: number;  // 学习时长（毫秒）
     dialogueRounds?: number;       // 对话轮数
     isResolved: boolean;           // 是否已解决
   }
   ```

2. **新增函数**：`getAnchorLearningStats(anchorId: string)`

   ```typescript
   interface AnchorLearningStats {
     learningDurationMs: number | null;
     dialogueRounds: number;
     isResolved: boolean;
   }
   ```

3. **ConfusionHotspot 接口扩展**：

   ```typescript
   interface ConfusionHotspot {
     // 现有字段...
     
     // 新增
     resolvedCount: number;  // 已解决数
     resolvedRate: number;   // 搞定率 (0-100)
   }
   ```

---

## 四、实现优先级

| 优先级 | 改动项 | 工作量 | 价值 |
|--------|--------|--------|------|
| P0 | 家长端：困惑点状态图标（✅/🔴） | 0.5h | 让家长一眼看出哪些已解决 |
| P0 | 老师端：困惑热点增加搞定率列 | 1h | 让老师知道哪些需要重讲 |
| P1 | 家长端：困惑点增加学习时长 | 1h | 让家长看到孩子的投入 |
| P1 | 家长端：困惑点增加对话轮数 | 1h | 让家长看到互动深度 |
| P2 | 老师端：低搞定率标签提示 | 0.5h | 降低老师的认知负担 |

**总工作量**：约 4 小时

---

## 五、验收标准

### 家长端

- [ ] 困惑点列表中，已解决的显示 ✅，未解决的显示 🔴
- [ ] 已解决的困惑点显示学习时长（格式：X分钟）
- [ ] 有 AI 对话记录的困惑点显示对话轮数（格式：X轮）

### 老师端

- [ ] 困惑热点表格新增"搞定率"列
- [ ] 搞定率以百分比形式显示
- [ ] 搞定率低于 50% 的行有视觉提示

---

## 六、技术细节

### 学习时长计算

```typescript
function getLearningDuration(anchor: Anchor): number | null {
  if (anchor.status !== 'resolved' || !anchor.resolvedAt) {
    return null;
  }
  return anchor.resolvedAt.getTime() - anchor.createdAt.getTime();
}
```

### 对话轮数计算

```typescript
async function getDialogueRounds(anchorId: string): Promise<number> {
  const cache = await getTutorResponseCache(anchorId);
  if (!cache?.chatHistory) return 0;
  
  try {
    const history = JSON.parse(cache.chatHistory);
    // 只计算用户消息数，不包括 AI 回复
    return history.filter((msg: any) => msg.role === 'user').length;
  } catch {
    return 0;
  }
}
```

### 搞定率计算

```typescript
function calculateResolvedRate(anchors: Anchor[]): number {
  if (anchors.length === 0) return 0;
  const resolved = anchors.filter(a => a.status === 'resolved').length;
  return Math.round((resolved / anchors.length) * 100);
}
```

---

## 七、后续迭代方向

本版本只做数据的"流动"，不做数据的"分析"。以下是后续可能的方向，留作参考：

1. **时间维度**：按天/周展示学习趋势
2. **知识点维度**：自动识别困惑点对应的知识点
3. **对比维度**：与班级平均水平对比
4. **预警机制**：连续多天未解决的困惑点提醒

这些都需要更多数据积累后再考虑。

---

*文档版本：v1.0*
*创建日期：2026-01-12*
