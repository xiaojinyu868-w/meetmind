# Open Notebook 项目功能分析

> 开源、隐私优先的 Google NotebookLM 替代方案

---

## 📋 项目概述

Open Notebook 是一个完全开源的研究助手工具，支持本地部署，可接入 16+ 种 AI 模型提供商。

**技术栈**：
- 前端：Next.js + React + TypeScript
- 后端：Python + FastAPI
- 数据库：SurrealDB
- AI抽象层：Esperanto 库

---

## 🧩 原子功能清单

### 一、笔记本管理 (Notebooks)

| 功能 | 说明 | 可定制点 |
|------|------|----------|
| 创建笔记本 | 创建独立的研究空间 | 笔记本名称、描述 |
| 删除笔记本 | 删除整个研究空间 | - |
| 笔记本列表 | 查看所有笔记本 | 排序、筛选逻辑 |
| 笔记本详情 | 查看单个笔记本内容 | 展示布局 |

---

### 二、内容源管理 (Sources)

| 功能 | 说明 | 可定制点 |
|------|------|----------|
| 上传 PDF | 解析 PDF 文档内容 | PDF 解析器选择 |
| 上传音频 | 语音转文字处理 | STT 模型选择 |
| 上传视频 | 提取视频内容/字幕 | 视频处理逻辑 |
| 导入网页 | 抓取网页内容 | 网页抓取工具 (Firecrawl/Jina) |
| 导入 Office 文档 | Word/Excel/PPT 解析 | 文档解析器 |
| 内容提取 | 从源中提取文本 | 提取规则 |
| 源内容预览 | 查看原始内容 | 预览界面 |
| 删除源 | 移除内容源 | - |

---

### 三、笔记管理 (Notes)

| 功能 | 说明 | 可定制点 |
|------|------|----------|
| 创建笔记 | 手动创建笔记 | 笔记模板 |
| AI 生成笔记 | 基于源内容自动生成 | 生成提示词 |
| 编辑笔记 | 修改笔记内容 | 编辑器类型 |
| 删除笔记 | 移除笔记 | - |
| 笔记列表 | 查看所有笔记 | 展示方式 |

---

### 四、洞察分析 (Insights)

| 功能 | 说明 | 可定制点 |
|------|------|----------|
| 生成洞察 | AI 分析源内容生成见解 | 分析提示词 |
| 查看洞察 | 展示 AI 生成的分析 | 展示格式 |
| 洞察引用 | 追踪洞察来源 | 引用格式 |

---

### 五、内容转换 (Transformations)

| 功能 | 说明 | 可定制点 |
|------|------|----------|
| 内容总结 | 生成内容摘要 | 总结长度、风格 |
| 关键点提取 | 提取核心要点 | 提取数量 |
| 自定义转换 | 用户定义的处理规则 | **完全可定制提示词** |
| 批量转换 | 对多个源执行转换 | 并发数量 |

---

### 六、AI 对话 (Chat)

| 功能 | 说明 | 可定制点 |
|------|------|----------|
| 笔记本对话 | 基于笔记本内容对话 | 系统提示词 `chat.jinja` |
| 源内容对话 | 针对特定源深度对话 | 系统提示词 `source_chat.jinja` |
| 多轮对话 | 保持对话上下文 | 上下文长度 |
| 上下文选择 | 选择 AI 可访问的内容 | 3 级上下文控制 |
| 引用追踪 | 回答中标注来源 | 引用格式 |
| 会话管理 | 创建/删除对话会话 | - |

---

### 七、播客生成 (Podcasts)

| 功能 | 说明 | 可定制点 |
|------|------|----------|
| 生成播客脚本 | AI 生成对话脚本 | 脚本提示词 |
| 多说话人支持 | 1-4 个说话人 | 说话人数量 |
| 说话人档案 | 定义说话人角色 | 姓名、性格、声音 |
| 剧集档案 | 定义播客风格 | 主题、时长、风格 |
| 文字转语音 | 生成音频文件 | TTS 模型选择 |
| 脚本编辑 | 手动修改脚本 | - |
| 音频导出 | 下载生成的音频 | 音频格式 |

---

### 八、搜索功能 (Search)

| 功能 | 说明 | 可定制点 |
|------|------|----------|
| 全文搜索 | 关键词匹配搜索 | 搜索算法 |
| 向量搜索 | 语义相似度搜索 | 嵌入模型 |
| 混合搜索 | 结合全文+向量 | 权重配置 |
| 跨笔记本搜索 | 搜索所有内容 | 搜索范围 |

---

### 九、嵌入向量 (Embedding)

| 功能 | 说明 | 可定制点 |
|------|------|----------|
| 生成嵌入 | 为内容生成向量 | 嵌入模型选择 |
| 重建嵌入 | 重新生成所有向量 | - |
| 向量存储 | 存储向量数据 | 存储方式 |

---

### 十、模型管理 (Models)

| 功能 | 说明 | 可定制点 |
|------|------|----------|
| 模型列表 | 查看可用模型 | - |
| 默认模型配置 | 设置各功能默认模型 | 7 种默认模型类型 |
| 模型切换 | 运行时切换模型 | - |

**支持的模型类型**：
- `default_chat_model` - 默认聊天模型
- `default_transformation_model` - 默认转换模型
- `large_context_model` - 大上下文模型
- `default_text_to_speech_model` - 默认 TTS 模型
- `default_speech_to_text_model` - 默认 STT 模型
- `default_embedding_model` - 默认嵌入模型
- `default_tools_model` - 默认工具模型

---

### 十一、系统配置 (Settings/Config)

| 功能 | 说明 | 可定制点 |
|------|------|----------|
| API 密钥管理 | 配置各提供商密钥 | 支持 16+ 提供商 |
| 密码保护 | 设置访问密码 | `OPEN_NOTEBOOK_PASSWORD` |
| 超时配置 | API 调用超时设置 | 多个超时参数 |
| SSL 配置 | 自定义证书 | CA 证书路径 |

---

### 十二、身份认证 (Auth)

| 功能 | 说明 | 可定制点 |
|------|------|----------|
| 密码验证 | 简单密码认证 | 密码策略 |
| 会话管理 | 登录状态维护 | 会话时长 |

---

## 🔌 支持的 AI 提供商

### 大语言模型 (LLM)
| 提供商 | 环境变量 |
|--------|----------|
| OpenAI | `OPENAI_API_KEY` |
| Anthropic | `ANTHROPIC_API_KEY` |
| Google Gemini | `GOOGLE_API_KEY` |
| Mistral | `MISTRAL_API_KEY` |
| DeepSeek | `DEEPSEEK_API_KEY` |
| Groq | `GROQ_API_KEY` |
| xAI | `XAI_API_KEY` |
| Ollama (本地) | `OLLAMA_API_BASE` |
| OpenRouter | `OPENROUTER_API_KEY` |
| Azure OpenAI | `AZURE_OPENAI_API_KEY` |
| OpenAI 兼容端点 | `OPENAI_COMPATIBLE_BASE_URL` |

### 语音服务
| 功能 | 提供商 | 环境变量 |
|------|--------|----------|
| 语音转文字 (STT) | OpenAI Whisper | `OPENAI_API_KEY` |
| 语音转文字 (STT) | Groq | `GROQ_API_KEY` |
| 文字转语音 (TTS) | OpenAI | `OPENAI_API_KEY` |
| 文字转语音 (TTS) | ElevenLabs | `ELEVENLABS_API_KEY` |

### 嵌入模型
| 提供商 | 环境变量 |
|--------|----------|
| OpenAI | `OPENAI_API_KEY` |
| Google | `GOOGLE_API_KEY` |
| Voyage | `VOYAGE_API_KEY` |
| Mistral | `MISTRAL_API_KEY` |

---

## 📁 核心文件结构

```
open-notebook/
├── api/                    # FastAPI 后端
│   ├── main.py            # API 入口，19 个路由模块
│   └── routers/           # 各功能路由
├── frontend/              # Next.js 前端
├── open_notebook/         # 核心业务逻辑
│   └── domain/           # 领域模型
├── prompts/               # AI 提示词模板 ⭐
│   ├── chat.jinja        # 聊天提示词
│   ├── source_chat.jinja # 源内容聊天提示词
│   ├── ask/              # 问答提示词
│   └── podcast/          # 播客提示词
├── migrations/            # 数据库迁移
└── docker-compose.yml     # 容器编排
```

---

## 🎯 可定制的核心入口

### 1. 提示词模板 (最易定制)
位置：`prompts/` 目录

| 文件 | 用途 | 定制效果 |
|------|------|----------|
| `chat.jinja` | 笔记本对话 | 改变 AI 对话风格、引用格式 |
| `source_chat.jinja` | 源内容对话 | 改变深度分析方式 |
| `ask/*.jinja` | 问答功能 | 改变回答风格 |
| `podcast/*.jinja` | 播客生成 | 改变播客风格、结构 |

### 2. 环境变量配置
位置：`.env` 文件

```bash
# 核心配置
OPENAI_API_KEY=sk-xxx          # AI 服务密钥
OPEN_NOTEBOOK_PASSWORD=xxx     # 访问密码

# 性能调优
API_CLIENT_TIMEOUT=300         # 前端超时
ESPERANTO_LLM_TIMEOUT=60       # AI 调用超时
TTS_BATCH_SIZE=2               # TTS 并发数
SURREAL_COMMANDS_MAX_TASKS=5   # 最大并发任务
```

### 3. 默认模型配置
通过 API 或界面设置 7 种默认模型

### 4. 前端界面
位置：`frontend/` 目录
- 可修改 UI 布局、样式、交互

### 5. API 路由
位置：`api/routers/` 目录
- 可扩展新功能、修改现有接口

---

## 🌐 多语言支持

已支持语言：
- 🇩🇪 德语
- 🇪🇸 西班牙语
- 🇫🇷 法语
- 🇯🇵 日语
- 🇰🇷 韩语
- 🇧🇷 葡萄牙语
- 🇷🇺 俄语
- 🇨🇳 中文

**添加中文支持**：需要在前端 `frontend/` 中添加中文翻译文件。

---

## 📊 API 路由总览 (19 个模块)

| 路由 | 功能 |
|------|------|
| `/auth` | 身份认证 |
| `/config` | 配置管理 |
| `/notebooks` | 笔记本 CRUD |
| `/notes` | 笔记 CRUD |
| `/sources` | 内容源管理 |
| `/insights` | 洞察分析 |
| `/transformations` | 内容转换 |
| `/chat` | AI 对话 |
| `/source-chat` | 源内容对话 |
| `/search` | 搜索功能 |
| `/models` | 模型管理 |
| `/embedding` | 嵌入向量 |
| `/embeddings` | 嵌入重建 |
| `/podcasts` | 播客管理 |
| `/episode-profiles` | 剧集档案 |
| `/speaker-profiles` | 说话人档案 |
| `/commands` | 命令处理 |
| `/context` | 上下文管理 |
| `/settings` | 系统设置 |

---

## 🔧 快速定制指南

### 改变 AI 对话风格
1. 编辑 `prompts/chat.jinja`
2. 修改系统角色定义和回答规范
3. 重启服务生效

### 添加新的 AI 提供商
1. 在 `.env` 中添加 API 密钥
2. 系统自动识别可用模型
3. 在设置中选择新模型

### 修改播客生成逻辑
1. 编辑 `prompts/podcast/` 下的模板
2. 调整说话人数量、风格等参数

### 扩展 API 功能
1. 在 `api/routers/` 创建新路由
2. 在 `api/main.py` 注册路由
3. 重新构建 Docker 镜像

---

## 📝 总结

Open Notebook 的核心价值在于**模块化**和**可定制性**：

1. **提示词驱动**：大部分 AI 行为由 Jinja2 模板控制
2. **多模型支持**：可随时切换 AI 提供商
3. **完整 API**：所有功能都有 REST 接口
4. **开源透明**：完整源码可审计和修改

最容易入手的定制点是 `prompts/` 目录下的提示词模板，无需编程即可改变 AI 行为。
